<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="ChenYun">





<title>组件openAPI合规性处理 | ChenYun&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.1.1"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">ChenYun&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">ChenYun&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">组件openAPI合规性处理</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">ChenYun</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">August 26, 2020&nbsp;&nbsp;22:59:36</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="组件OpenAPI合规性处理"><a href="#组件OpenAPI合规性处理" class="headerlink" title="组件OpenAPI合规性处理"></a>组件OpenAPI合规性处理</h2><h3 id="Swagger以及参数配置"><a href="#Swagger以及参数配置" class="headerlink" title="Swagger以及参数配置"></a>Swagger以及参数配置</h3><p>具体参考SwaggerConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hikvision.ccms.start.swagger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Sets;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ParameterBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ResponseMessageBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.schema.ModelRef;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.AllowableRangeValues;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Parameter;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ResponseMessage;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.paths.RelativePathProvider;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> springfox.documentation.builders.PathSelectors.ant;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * swagger2配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@ConditionalOnExpression(&quot;$&#123;seashell.swagger.enable:false&#125;==true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;component.id:&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String componentId;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;component.segment.id:&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String segmentId;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;component.name:&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String componentName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;component.version:&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String componentVersion;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;component.se.name:&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String componentSEName;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 组件内部接口swagger</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Docket <span class="title">webRestApi</span><span class="params">(RelativePathProvider relativePathProvider)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">				.groupName(<span class="string">&quot;1.&quot;</span> + componentId + <span class="string">&quot;_web&quot;</span>)</span><br><span class="line">				.apiInfo(apiInfo())</span><br><span class="line">				.directModelSubstitute(LocalDateTime.class, Date.class)</span><br><span class="line">				.directModelSubstitute(LocalDate.class, String.class)</span><br><span class="line">				.directModelSubstitute(LocalTime.class, String.class)</span><br><span class="line">				.select()</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.hikvision&quot;</span>))</span><br><span class="line">				.paths(PathSelectors.regex(<span class="string">&quot;^((?!/api/).)*$&quot;</span>))</span><br><span class="line">				.build()</span><br><span class="line">				.pathProvider(relativePathProvider)</span><br><span class="line">				.globalResponseMessage(RequestMethod.GET, getResponseMessageList())</span><br><span class="line">				.globalResponseMessage(RequestMethod.POST, getResponseMessageList());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 组件api接口swagger</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Docket <span class="title">openRestApi</span><span class="params">(RelativePathProvider relativePathProvider)</span> </span>&#123;</span><br><span class="line">		ParameterBuilder tokenPar = <span class="keyword">new</span> ParameterBuilder();</span><br><span class="line">		List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		tokenPar.name(<span class="string">&quot;Token&quot;</span>).description(<span class="string">&quot;令牌&quot;</span>).modelRef(<span class="keyword">new</span> ModelRef(<span class="string">&quot;string&quot;</span>)).parameterType(<span class="string">&quot;header&quot;</span>).scalarExample(<span class="string">&quot;123123&quot;</span>).required(<span class="keyword">true</span>).allowableValues(<span class="keyword">new</span> AllowableRangeValues(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;128&quot;</span>)).build();</span><br><span class="line">		pars.add(tokenPar.build());</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">				.groupName(<span class="string">&quot;2.&quot;</span> + componentId + <span class="string">&quot;_api&quot;</span>)</span><br><span class="line">				.host(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">				.apiInfo(apiInfo())</span><br><span class="line">				.directModelSubstitute(LocalDateTime.class, Date.class)</span><br><span class="line">				.directModelSubstitute(LocalDate.class, String.class)</span><br><span class="line">				.directModelSubstitute(LocalTime.class, String.class)</span><br><span class="line">				.produces(Sets.newHashSet(<span class="string">&quot;application/json&quot;</span>))</span><br><span class="line">				.consumes(Sets.newHashSet(<span class="string">&quot;application/json&quot;</span>))</span><br><span class="line">				.protocols(Sets.newHashSet(<span class="string">&quot;http&quot;</span>, <span class="string">&quot;https&quot;</span>))</span><br><span class="line">				.select()</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.hikvision.ccms.api&quot;</span>))</span><br><span class="line">				.paths(Predicates.and(ant(<span class="string">&quot;/api/**&quot;</span>)))</span><br><span class="line">				.build().globalOperationParameters(pars)</span><br><span class="line">				.pathProvider(relativePathProvider)</span><br><span class="line">				.globalResponseMessage(RequestMethod.GET, getResponseMessageList())</span><br><span class="line">				.globalResponseMessage(RequestMethod.POST, getResponseMessageList());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * RelativePathProvider用于设置basePath</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RelativePathProvider <span class="title">relativePathProvider</span><span class="params">(ServletContext servletContext)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RelativePathProvider(servletContext) &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">getApplicationBasePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;/&quot;</span> + componentId;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * API描述</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(componentName + <span class="string">&quot;组件&quot;</span> + segmentId + <span class="string">&quot;服务接口&quot;</span>).description(componentName + <span class="string">&quot;API接口描述&quot;</span>).version(componentVersion).termsOfServiceUrl(<span class="string">&quot;http://www.hik-cloud.com/&quot;</span>).contact(<span class="keyword">new</span> Contact(componentSEName, <span class="string">&quot;http://www.hikvision.com/&quot;</span>, componentSEName + <span class="string">&quot;@hikvision.com.cn&quot;</span>)).build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取List&lt;ResponseMessage&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> List&lt;ResponseMessage&gt; <span class="title">getResponseMessageList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;ResponseMessage&gt; responseMessageList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		responseMessageList.add(<span class="keyword">new</span> ResponseMessageBuilder().code(<span class="number">401</span>).message(<span class="string">&quot;Unauthorized&quot;</span>).build());</span><br><span class="line">		responseMessageList.add(<span class="keyword">new</span> ResponseMessageBuilder().code(<span class="number">403</span>).message(<span class="string">&quot;Forbidden&quot;</span>).build());</span><br><span class="line">		responseMessageList.add(<span class="keyword">new</span> ResponseMessageBuilder().code(<span class="number">404</span>).message(<span class="string">&quot;Not Found&quot;</span>).build());</span><br><span class="line">		responseMessageList.add(<span class="keyword">new</span> ResponseMessageBuilder().code(<span class="number">500</span>).message(<span class="string">&quot;Server Error&quot;</span>).build());</span><br><span class="line">		<span class="keyword">return</span> responseMessageList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">		registry.addResourceHandler(<span class="string">&quot;swagger-ui.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">		registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对应的application.properties配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#组件名称 需对应HiCoo上的组件名称</span></span><br><span class="line"><span class="meta">component.name</span>=<span class="string">\u5de5\u5730\u8003\u52e4\u5e94\u7528\u670d\u52a1</span></span><br><span class="line"><span class="comment">#组件id</span></span><br><span class="line"><span class="meta">component.id</span>=<span class="string">ccms</span></span><br><span class="line"><span class="comment">#组件段标识</span></span><br><span class="line"><span class="meta">component.segment.id</span>=<span class="string">ccmsweb</span></span><br><span class="line"><span class="comment">#组件版本</span></span><br><span class="line"><span class="meta">component.version</span>=<span class="string">1.1.100</span></span><br><span class="line"><span class="comment">#组件负责人</span></span><br><span class="line"><span class="meta">component.se.name</span>=<span class="string">yejianhui</span></span><br><span class="line"><span class="comment">#是否启用swagger配置</span></span><br><span class="line"><span class="meta">seashell.swagger.enable</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol>
<li>由于当前OpenAPI合规性只对组件对外接口有要求，所以配置Swagger时，配置了两个Docket以区分对外接口和前后端分离接口。每个Docket可以通过包名以及URLPath来区分。</li>
<li>application.properties上的component.name需要unicode编码</li>
<li>以上配置确保application.properties和cas-client.properties中的不要重复配置</li>
</ol>
<h3 id="补充代码注解"><a href="#补充代码注解" class="headerlink" title="补充代码注解"></a>补充代码注解</h3><ol>
<li><p>Controller增加@API注解</p>
<p>![controller api注解](C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\controller api注解.bmp)<br>注意：  1. tags内容最好以数组加下划线开头便于排序</p>
<p>​             2. 注解字段tags以及description不可缺少</p>
</li>
<li><p>Method增加@ApiOperation @ApiImplicitParams @ApiImplicitParam注解：</p>
<p><img src="C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\method注解.bmp" alt="method注解"></p>
<p>注意： 1. 对于Response如果存在泛型<strong>必须设置泛型</strong>否则最后的文档不显示泛型内容，例如上图BaseResponse&lt;List<UnitAttendanceOnlineStatisticsVo>&gt;</p>
<p>​            2. 需要填写的注解字段如图，<strong>不能缺少</strong>，特别是example和allowableValues。allowableValues可填写内容可以参照swagger对于该字段的注释，不过<strong>不要使用infinity</strong>，hido校验的时候不认识<img src="C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\allowableValues注释.bmp" alt="allowableValues注释"></p>
</li>
<li><p>对于入参对象以及返参对象增加@ApiModel @ApiModelProperty注解：</p>
<p><img src="C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\model注解.bmp" alt="model注解"></p>
<p>注意： 需要填写的注解字段如图，<strong>不能缺少</strong></p>
</li>
</ol>
<h3 id="准备api文档"><a href="#准备api文档" class="headerlink" title="准备api文档"></a>准备api文档</h3><p>总共需要6份文档，编写完成后存放于组件代码目录下并推送到SVN。例如：</p>
<p><img src="C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\api-doc.bmp" alt="api-doc"></p>
<ol>
<li>ccms.json：组件openapi json描述文件，<strong>必须以组件标识命名</strong>，例如ccms.json envms.json ihms.json</li>
<li>appendix.md：组件数据字典 错误码</li>
<li>guidance.md：编程引导</li>
<li>statement.md：组件简介</li>
<li>tail.md</li>
<li>以上md文件如果涉及到图片，需要文件夹存放相应的图片，该文件夹以及图片名称采用<strong>英文命名，不要出现中文</strong>，最好附带组件标识例如ccms_image_xxxxxx.jpg，否则一旦出现和其他组件图片名称路径一致，容易错误引用到其他组件的图片</li>
</ol>
<h4 id="ccms-json"><a href="#ccms-json" class="headerlink" title="ccms.json"></a>ccms.json</h4><p>组件openapi json描述文件通过swagger接口导出，存在2种方法：</p>
<ol>
<li><p>通过swagger ui html页面导出，选择对应的group，点击连接，将返回的json复制到文件即可</p>
<p>![swagger output json](C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\swagger output json.bmp)</p>
<p>![json html](C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\json html.bmp)</p>
<ol start="2">
<li><p>通过工程Test导出</p>
<ol>
<li><p>pom增加plugin配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">systemPropertyVariables</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">io.springfox.staticdocs.outputDir</span>&gt;</span>$&#123;project.build.directory&#125;/swagger<span class="tag">&lt;/<span class="name">io.springfox.staticdocs.outputDir</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">systemPropertyVariables</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写Test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hikvision.ccms.start;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hikvision.ccms.common.i18n.I18nUtil;</span><br><span class="line"><span class="keyword">import</span> com.hikvision.ccms.common.util.ResponseUtil;</span><br><span class="line"><span class="keyword">import</span> com.hikvision.seashell.log.util.LogFormatter;</span><br><span class="line"><span class="keyword">import</span> com.hikvision.seashell.util.errorcode.IErrorCode;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.reflections.Reflections;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mock.web.MockHttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MvcResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.test.web.servlet.setup.MockMvcBuilders.webAppContextSetup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SwaggerTest用于导出Swagger Json</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> chenyun17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = WebApplication.class)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String OUTPUT_PATH_PROPERTY_KEY = <span class="string">&quot;io.springfox.staticdocs.outputDir&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SWAGGER_API_DOCS_BASE_URL = <span class="string">&quot;/v2/api-docs?group=%s&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SWAGGER_JSON_FILE_NAME = <span class="string">&quot;Swagger-%s.json&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext wac;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Docket&gt; dockets;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mockMvc = webAppContextSetup(<span class="keyword">this</span>.wac).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 导出错误码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportErrorCodeMd</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;IErrorCode&gt; errorCodeList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Reflections reflection = <span class="keyword">new</span> Reflections(<span class="string">&quot;com.hikvision.ccms&quot;</span>);</span><br><span class="line">        Set&lt;Class&lt;? extends IErrorCode&gt;&gt; classSet =  reflection.getSubTypesOf(IErrorCode.class);</span><br><span class="line">        <span class="keyword">for</span>(Class&lt;? extends IErrorCode&gt; errorCodeClass : classSet)&#123;</span><br><span class="line">            IErrorCode[] errorCodes = errorCodeClass.getEnumConstants();</span><br><span class="line">            errorCodeList.addAll(Arrays.asList(errorCodes));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(errorCodeList.size());</span><br><span class="line">        StringBuilder errorCodeMdString = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        errorCodeMdString.append(<span class="string">&quot;&gt; **公共错误码**\n&quot;</span>);</span><br><span class="line">        errorCodeMdString.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        errorCodeMdString.append(<span class="string">&quot;| 错误码 | 错误提示消息 |\n&quot;</span>);</span><br><span class="line">        errorCodeMdString.append(<span class="string">&quot;| ---------- | ------------------- |\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (IErrorCode errorCode : errorCodeList) &#123;</span><br><span class="line">            String code = errorCode.getCode();</span><br><span class="line">            code = ResponseUtil.formatErrorCode(code);</span><br><span class="line">            String message = errorCode.getMessage();</span><br><span class="line">            message = ResponseUtil.i18Format(code, message, <span class="keyword">null</span>);</span><br><span class="line">            errorCodeMdString.append(<span class="string">&quot;| &quot;</span>+ code + <span class="string">&quot; | &quot;</span> + message + <span class="string">&quot; |\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String outputDir = System.getProperty(OUTPUT_PATH_PROPERTY_KEY);</span><br><span class="line">        Files.createDirectories(Paths.get(outputDir));</span><br><span class="line">        <span class="keyword">try</span> (BufferedWriter writer = Files.newBufferedWriter(Paths.get(outputDir, <span class="string">&quot;appendix.md&quot;</span>), StandardCharsets.UTF_8)) &#123;</span><br><span class="line">            writer.write(errorCodeMdString.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 导出Swagger Json文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportSwaggerJson</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dockets == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.info(LogFormatter.toMsg(<span class="string">&quot;dockets is not configured, can not export swagger json&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取json文件输出路径</span></span><br><span class="line">        String outputDir = System.getProperty(OUTPUT_PATH_PROPERTY_KEY);</span><br><span class="line">        log.info(LogFormatter.toMsg(<span class="string">&quot;start export swagger json&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span> (Docket docket : dockets) &#123;</span><br><span class="line">            String groupName = docket.getGroupName();</span><br><span class="line">            <span class="comment">//调用swagger服务获取json数据</span></span><br><span class="line">            MvcResult mvcResult = mockMvc.perform(get(String.format(SWAGGER_API_DOCS_BASE_URL, groupName)).accept(MediaType.APPLICATION_JSON)).andExpect(status().isOk()).andReturn();</span><br><span class="line">            MockHttpServletResponse response = mvcResult.getResponse();</span><br><span class="line">            String swaggerJson = response.getContentAsString();</span><br><span class="line">            <span class="comment">//写入json数据到文件</span></span><br><span class="line">            Files.createDirectories(Paths.get(outputDir));</span><br><span class="line">            <span class="keyword">try</span> (BufferedWriter writer = Files.newBufferedWriter(Paths.get(outputDir, String.format(SWAGGER_JSON_FILE_NAME, groupName)), StandardCharsets.UTF_8)) &#123;</span><br><span class="line">                writer.write(swaggerJson);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(LogFormatter.toMsg(<span class="string">&quot;export swagger json finish, output path is &#123;&#125;&quot;</span>, outputDir));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行exportSwaggerJson即可导出json文件，执行exportErrorCodeMd即可导出错误码MD文件，导出文件位于io.springfox.staticdocs.outputDir所配置的路径</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="修改hido组件持续集成工作流配置"><a href="#修改hido组件持续集成工作流配置" class="headerlink" title="修改hido组件持续集成工作流配置"></a>修改hido组件持续集成工作流配置</h3><p>修改hido组件持续集成工作流配置中的构建命令，在构建过程中将代码路径中的文档复制到组件包dev/api路径下</p>
<p>以ccms组件为例在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rf ../ccms-package/ccms/*   ../output</span><br></pre></td></tr></table></figure>

<p>上增加构建命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ../ccms_package/ccms/dev/api/*</span><br><span class="line">cp -rf api-doc/* ../ccms-package/ccms/dev/api/</span><br><span class="line">mv ccms-start/target/swagger/Swagger-2.ccms_api.json ccms-start/target/swagger/ccms.json</span><br><span class="line">cp -rf ccms-start/target/swagger/ccms.json ../ccms_package/ccms/dev/api/</span><br></pre></td></tr></table></figure>

<p>如图：</p>
<p>![hido cmd](C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\hido cmd.bmp)</p>
<h3 id="API-Display网站审核"><a href="#API-Display网站审核" class="headerlink" title="API Display网站审核"></a>API Display网站审核</h3><p>经过以上步骤，在组件打包完成后，需要在 <a target="_blank" rel="noopener" href="http://api-display.hikvision.com.cn/api">http://api-display.hikvision.com.cn/api</a> 网站上进行审核，才能进行显示，默认组件负责人拥有审核权限，如果没有联系李超39处理权限问题</p>
<p>审核位置：</p>
<p>![api display checkout](C:\Users\chenyun17\Desktop\源码笔记\OpenAPI合规性处理Image\api display checkout.bmp)</p>
<p>审核完成之后可以在接口展示栏目查看到对应组件的api文档</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>ChenYun</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://blog.yuner.fun/2020/08/26/%E7%BB%84%E4%BB%B6openAPI%E5%90%88%E8%A7%84%E6%80%A7%E5%A4%84%E7%90%86/">http://blog.yuner.fun/2020/08/26/%E7%BB%84%E4%BB%B6openAPI%E5%90%88%E8%A7%84%E6%80%A7%E5%A4%84%E7%90%86/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/08/26/quartz-job/">quartz-job</a>
            
            
            <a class="next" rel="next" href="/2020/08/26/Zipkin%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Zipkin源码分析</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© ChenYun | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
<script src='https://unpkg.com/mermaid@8.7.0/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({{ JSON.stringify(theme.mermaid.options) }});
    }
  </script>
</footer>

    </div>
</body>
</html>
